# Apache Cassandra

node_types:

  dice.components.cassandra.Base:
    derived_from: dice.chef.SoftwareComponent
    properties:
      configure_runlist:
        default:
          - recipe[java::default]
          - recipe[cassandra::default]
          - recipe[cassandra::configure]
      start_runlist:
        default:
          - recipe[cassandra::start]
      chef_attributes:
        default:
          java:
            jdk_version: "8"

  # Next two types are present here to make it possible to change them in the
  # future without breaking our consumers
  dice.components.cassandra.Seed:
    derived_from: dice.components.cassandra.Base

  dice.components.cassandra.Worker:
    derived_from: dice.components.cassandra.Base


  # Firewall rules that are needed for proper communication in cassandra
  dice.firewall_rules.cassandra.Common:
    derived_from: dice.firewall_rules.Base
    properties:
      rules:
        default:
          - remote_ip_prefix: 0.0.0.0/0
            port: 7000
          - remote_ip_prefix: 0.0.0.0/0
            port: 7001
          - remote_ip_prefix: 0.0.0.0/0
            port: 7199
          - remote_ip_prefix: 0.0.0.0/0
            port: 9042
          - remote_ip_prefix: 0.0.0.0/0
            port: 9160

relationships:

  dice.relationships.cassandra.ConnectedToSeed:
    derived_from: cloudify.relationships.connected_to
    properties:
      connection_type: { default: all_to_one }
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure:
          implementation: dice.dice_plugin.tasks.cassandra.gather_seeds
