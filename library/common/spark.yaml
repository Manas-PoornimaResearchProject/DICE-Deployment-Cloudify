# Apache Spark

node_types:

  dice.components.spark.Base:
    derived_from: dice.chef.SoftwareComponent
    properties:
      create_runlist:
        default:
          - recipe[dice_common::host]
          - recipe[apt::default]
          - recipe[java::default]
          - recipe[spark::default]
      configure_runlist:
        default:
          - recipe[spark::configure]
      start_runlist:
        default:
          - recipe[spark::start]
      chef_attributes:
        default:
          java:
            jdk_version:    { get_input: java_version }
            install_flavor: { get_input: java_flavor  }

  dice.components.spark.Master:
    derived_from: dice.components.spark.Base
    properties:
      chef_attributes:
        default:
          spark:
            type: master

  dice.components.spark.Worker:
    derived_from: dice.components.spark.Base
    properties:
      chef_attributes:
        default:
          spark:
            type: worker


  # Firewall rules
  dice.firewall_rules.spark.Master:
    derived_from: dice.firewall_rules.Base
    properties:
      rules:
        default:
          - remote_ip_prefix: 0.0.0.0/0
            port: 6066
          - remote_ip_prefix: 0.0.0.0/0
            port: 7077

  dice.firewall_rules.spark.Worker:
    derived_from: dice.firewall_rules.Base
    properties:
      rules:
        default:
          - remote_ip_prefix: 0.0.0.0/0
            port: 7078


relationships:

  dice.relationships.spark.ConnectedToMaster:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure:
          implementation: dice.dice_plugin.tasks.base.copy_ip_from_target
          inputs:
            property: { default: master_ip }
