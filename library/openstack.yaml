imports:
  - http://dice-project.github.io/cloudify-openstack-plugin/1.4/plugin.yaml


inputs:

  centos_agent_user:
    description: >-
      User that can be used to login to CentOS cloud image (by default, this
      is set to centos, but can be changed if required).
    default: centos

  ubuntu_agent_user:
    description: >-
      User that can be used to login to Ubuntu cloud image (by default, this
      is set to ubuntu, but can be changed if required).
    default: ubuntu

  centos_image_id:
    description: >-
      OpenStack id of the CentOS image that should be used on CentOS instances.

  ubuntu_image_id:
    description: >-
      OpenStack id of the Ubuntu image that should be used on Ubuntu instances.

  small_flavor_id:
    description: >-
      OpenStack id of the flavor that should be used on small instances.

  medium_flavor_id:
    description: >-
      OpenStack id of the flavor that should be used on medium instances.

  large_flavor_id:
    description: >-
      OpenStack id of the flavor that should be used on large instances.


node_types:

  dice.firewall_rules.Base:
    derived_from: cloudify.openstack.nodes.SecurityGroup

  dice.VirtualIP:
    derived_from: cloudify.openstack.nodes.FloatingIP

  dice.hosts.Custom:
    derived_from: cloudify.openstack.nodes.Server
    properties:
      user:
        required: true
      cloudify_agent:
        default:
          user: { get_property: [ SELF, user ] }
      # FIXME: This is a temporary compatibility shim.
      monitoring:
        type: dice.types.MonitoringConfig

  # CentOS hosts
  dice.hosts.centos.Custom:
    derived_from: dice.hosts.Custom
    properties:
      image: { default: { get_input: centos_image_id } }
      user:  { default: { get_input: centos_agent_user } }

  dice.hosts.centos.Small:
    derived_from: dice.hosts.centos.Custom
    properties:
      flavor: { default: { get_input: small_flavor_id } }

  dice.hosts.centos.Medium:
    derived_from: dice.hosts.centos.Custom
    properties:
      flavor: { default: { get_input: medium_flavor_id } }

  dice.hosts.centos.Large:
    derived_from: dice.hosts.centos.Custom
    properties:
      flavor: { default: { get_input: large_flavor_id } }

  # Ubuntu hosts
  dice.hosts.ubuntu.Custom:
    derived_from: dice.hosts.Custom
    properties:
      image: { default: { get_input: ubuntu_image_id } }
      user:  { default: { get_input: ubuntu_agent_user } }

  dice.hosts.ubuntu.Small:
    derived_from: dice.hosts.ubuntu.Custom
    properties:
      flavor: { default: { get_input: small_flavor_id } }

  dice.hosts.ubuntu.Medium:
    derived_from: dice.hosts.ubuntu.Custom
    properties:
      flavor: { default: { get_input: medium_flavor_id } }

  dice.hosts.ubuntu.Large:
    derived_from: dice.hosts.ubuntu.Custom
    properties:
      flavor: { default: { get_input: large_flavor_id } }


  # Backwards compatibility - remove after some grace period
  dice.hosts.Small:
    derived_from: dice.hosts.ubuntu.Small
  dice.hosts.Medium:
    derived_from: dice.hosts.ubuntu.Medium
  dice.hosts.Large:
    derived_from: dice.hosts.ubuntu.Large


relationships:

  dice.relationships.ProtectedBy:
    derived_from: cloudify.openstack.server_connected_to_security_group

  dice.relationships.IPAvailableFrom:
    derived_from: cloudify.openstack.server_connected_to_floating_ip
